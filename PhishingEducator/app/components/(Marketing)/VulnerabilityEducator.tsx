import { WarningRegular } from '@fluentui/react-icons';
import VulnerabilityEducatorStyles from './VulnerabilityEducator.module.scss';
import { tokens } from '@fluentui/react-components';
import type { PhishingSimulationRun } from '@api/index';
import MailDetailMock from './MailDetailMock';

type VulnerabilityEducatorProps = {
  run: PhishingSimulationRun
}

export default function VulnerabilityEducator({ run }: VulnerabilityEducatorProps) {
  return (
    <section className={VulnerabilityEducatorStyles.VulnerabilityEducator}>
      <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__Interactive}>
        <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__Visualization}>
          <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__WindowContainer}>
            <MailDetailMock
              sentAt={run.sentAt ?? ''}
              sender={run.sender ?? ''}
              subject={run.subject ?? ''}
              content={run.content ?? ''}
              recognitionFeatures={run.recognitionFeatureValues ?? []}
            />
          </div>
          <div aria-hidden="true" className={VulnerabilityEducatorStyles.VulnerabilityEducator__Fade}>
            <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__FadeOverlay}></div>
          </div>
        </div>
      </div>
      <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__Static}>
        <dl className={VulnerabilityEducatorStyles.VulnerabilityEducator__RecognitionFeatures}>
          { run.recognitionFeatureValues.map(recognitionFeature => (
            <RecognitionFeatureInfo
              key={recognitionFeature.id}
              title={recognitionFeature.title}
              description={recognitionFeature.generalEducationalInstruction}
            />
          ))}
        </dl>
      </div>
    </section>
  )
}

type RecognitionFeatureInfoProps = {
  title: string;
  description: string;
}

function RecognitionFeatureInfo({ title, description }: RecognitionFeatureInfoProps) {
  return (
    <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__RecognitionFeature}>
      <dt className={VulnerabilityEducatorStyles.VulnerabilityEducator__RecognitionFeatureHead}>
        <div className={VulnerabilityEducatorStyles.VulnerabilityEducator__RecognitionFeatureIcon}>
          <WarningRegular fontSize="32px" color={tokens.colorBrandBackgroundInverted} />
        </div>
        { title }
      </dt>
      <dd className={VulnerabilityEducatorStyles.VulnerabilityEducator__RecognitionFeatureText}>
        { description }
      </dd>
    </div>
  )
}